# VPATH and shell configuration
top_srcdir = @top_srcdir@
srcdir     = @srcdir@
VPATH      = @srcdir@ 
SHELL      = /bin/sh

# Installation targets
#
prefix      = @prefix@
exec_prefix = @exec_prefix@
datarootdir = @datarootdir@
bindir      = @bindir@
libdir      = @libdir@
includedir  = @includedir@
mandir      = @mandir@
docdir      = @docdir@
pdfdir      = @pdfdir@
mandir      = @mandir@
man1dir     = ${mandir}/man1
man1ext     = .1

CC             = @CC@
CFLAGS         = @CFLAGS@
PTHREAD_CFLAGS = @PTHREAD_CFLAGS@ 
PIC_CFLAGS     = @PIC_CFLAGS@
SSE_CFLAGS     = @SSE_CFLAGS@ 
VMX_CFLAGS     = @VMX_CFLAGS@ 
CPPFLAGS       = @CPPFLAGS@
LDFLAGS        = @LDFLAGS@
DEFS           = @DEFS@
LIBS           = -leasel  @LIBS@ @LIBGSL@ @PTHREAD_LIBS@ -lm

AR        = @AR@ 
RANLIB    = @RANLIB@
INSTALL   = @INSTALL@

MYLIBDIRS = -L../${ESLDIR} -L./${IMPLDIR} -L../${SADIR} -L.
MYINCDIRS = -I../${ESLDIR} \
	    -I../${SADIR} \
	    -I${top_srcdir}/easel \
	    -I. \
	    -I${srcdir}


PROGS = \
	application.c

### COMMAND TO RETRIEVE ALL HEADER FILES IN PROJECT
# FILES=$(find src/ -type f | grep ".c$")
# for FILE in $FILES; do echo $FILE \\; done

HDRS =  \
   src/objects/mystring.h \
   src/objects/edgebound.h \
   src/objects/arg_opts.h \
   src/objects/score_matrix.h \
   src/objects/_objects.h \
   src/objects/dp_matrix.h \
   src/objects/worker.h \
   src/objects/structs_funcs.h \
   src/objects/structs_consts.h \
   src/objects/domain_def.h \
   src/objects/hmm_profile.h \
   src/objects/debugger.h \
   src/objects/edgebound_rows.h \
   src/objects/structs.h \
   src/objects/hmm_bg.h \
   src/objects/structs_macros.h \
   src/objects/io/reader.h \
   src/objects/io/_io.h \
   src/objects/args.h \
   src/objects/basic/gen_data.h \
   src/objects/basic/str.h \
   src/objects/basic/x_string.h \
   src/objects/basic/int.h \
   src/objects/basic/range.h \
   src/objects/basic/float.h \
   src/objects/basic/bound.h \
   src/objects/basic/double.h \
   src/objects/basic/template.h \
   src/objects/basic/char.h \
   src/objects/basic/_basic.h \
   src/objects/basic/trace.h \
   src/objects/matrix/matrix_2d.h \
   src/objects/matrix/matrix_3d_sparse.h \
   src/objects/matrix/matrix_3d.h \
   src/objects/worker_thread.h \
   src/objects/results.h \
   src/objects/alignment.h \
   src/objects/structs_buildopts.h \
   src/objects/f_index.h \
   src/objects/map/xxx_umap.h \
   src/objects/map/_map.h \
   src/objects/vectors/vector_float.h \
   src/objects/vectors/vector_trace.h \
   src/objects/vectors/vector_char.h \
   src/objects/vectors/_vectors.h \
   src/objects/vectors/vector_template.h \
   src/objects/vectors/vector_int.h \
   src/objects/vectors/vector_bound.h \
   src/objects/vectors/vector_double.h \
   src/objects/vectors/vector_range.h \
   src/objects/domain_x.h \
   src/objects/sequence.h \
   src/objects/clock.h \
   src/algs/_algs.h \
   src/reporting/mytimeout.h \
   src/reporting/myout.h \
   src/reporting/report_util.h \
   src/reporting/_reporting.h \
   src/reporting/mydomout.h \
   src/reporting/mythreshout.h \
   src/reporting/m8out.h \
   src/reporting/domtblout.h \
   src/reporting/mainout.h \
   src/work/work_report.h \
   src/work/work_index.h \
   src/work/work_etc.h \
   src/work/work_thresholds.h \
   src/work/_work.h \
   src/work/work_posterior.h \
   src/work/work_cloud.h \
   src/work/work_optacc.h \
   src/work/work_loop.h \
   src/work/work_fwdback.h \
   src/work/work_maintenance.h \
   src/macros/functions.h \
   src/macros/_macros.h \
   src/macros/buildopts.h \
   src/macros/constants.h \
   src/parsers/m8_parser.h \
   src/parsers/index_parser.h \
   src/parsers/arg_parser.h \
   src/parsers/seq_to_profile.h \
   src/parsers/hmm_parser.h \
   src/parsers/_parsers.h \
   src/parsers/seq_parser.h \
   src/algs_naive/bound_fwdbck_naive.h \
   src/algs_naive/_algs_naive.h \
   src/algs_vectorized/fwdback_vectorized.h \
   src/algs_vectorized/_algs_vectorized.h \
   src/algs_quad/fwdback_quad.h \
   src/algs_quad/bound_posterior_quad.h \
   src/algs_quad/bound_fwdbck_quad.h \
   src/algs_quad/traceback_quad.h \
   src/algs_quad/posterior_quad.h \
   src/algs_quad/_algs_quad.h \
   src/algs_quad/bound_viterbi_quad.h \
   src/algs_quad/pruning_quad.h \
   src/algs_quad/cloud_search_quad.h \
   src/algs_quad/merge_reorient_quad.h \
   src/algs_quad/posterior_null2_quad.h \
   src/algs_quad/ranged_fwdback_quad.h \
   src/algs_quad/viterbi_quad.h \
   src/pipelines/_pipelines.h \
   src/pipelines/workflow.h \
   src/algs_sparse/posterior_sparse.h \
   src/algs_sparse/_algs_sparse.h \
   src/algs_sparse/posterior_optacc_sparse.h \
   src/algs_sparse/viterbi_traceback_sparse.h \
   src/algs_sparse/bound_viterbi_sparse.h \
   src/algs_sparse/posterior_null2_sparse.h \
   src/algs_sparse/posterior_traceback_sparse.h \
   src/algs_sparse/bound_fwdbck_sparse.h \
   src/algs_linear/fwdback_linear.h \
   src/algs_linear/pruning_linear.h \
   src/algs_linear/cloud_search_linear.h \
   src/algs_linear/viterbi_linear.h \
   src/algs_linear/viterbi_traceback_linear.h \
   src/algs_linear/bound_fwdbck_linear.h \
   src/algs_linear/_algs_linear.h \
   src/algs_linear/merge_reorient_linear.h \
   src/utilities/misc.h \
   src/utilities/rng.h \
   src/utilities/statistics.h \
   src/utilities/dp_matrix_util.h \
   src/utilities/error_handler.h \
   src/utilities/testing.h \
   src/utilities/_utilities.h \
   src/utilities/vizualizer.h \

### COMMAND TO RETRIEVE ALL SOURCE FILES IN PROJECT
# FILES=$(find src/ -type f | grep ".c$")
# for FILE in $FILES; do echo $FILE \\; done

OBJS = \
   src/objects/edgebound.c \
   src/objects/sequence.c \
   src/objects/mystring.c \
   src/objects/domain_x.c \
   src/objects/arg_opts.c \
   src/objects/f_index.c \
   src/objects/worker_thread.c \
   src/objects/score_matrix.c \
   src/objects/alignment.c \
   src/objects/hmm_profile.c \
   src/objects/worker.c \
   src/objects/io/reader.c \
   src/objects/basic/bound.c \
   src/objects/basic/char.c \
   src/objects/basic/double.c \
   src/objects/basic/str.c \
   src/objects/basic/template.c \
   src/objects/basic/float.c \
   src/objects/basic/range.c \
   src/objects/basic/x_string.c \
   src/objects/basic/int.c \
   src/objects/basic/gen_data.c \
   src/objects/basic/trace.c \
   src/objects/debugger.c \
   src/objects/matrix/matrix_2d.c \
   src/objects/matrix/matrix_3d.c \
   src/objects/matrix/matrix_3d_sparse.c \
   src/objects/domain_def.c \
   src/objects/results.c \
   src/objects/map/xxx_umap.c \
   src/objects/args.c \
   src/objects/dp_matrix.c \
   src/objects/vectors/vector_float.c \
   src/objects/vectors/vector_bound.c \
   src/objects/vectors/vector_double.c \
   src/objects/vectors/vector_trace.c \
   src/objects/vectors/vector_int.c \
   src/objects/vectors/vector_char.c \
   src/objects/vectors/vector_template.c \
   src/objects/vectors/vector_range.c \
   src/objects/edgebound_rows.c \
   src/objects/clock.c \
   src/objects/structs.c \
   src/objects/hmm_bg.c \
   src/reporting/domtblout.c \
   src/reporting/mydomout.c \
   src/reporting/m8out.c \
   src/reporting/mythreshout.c \
   src/reporting/mainout.c \
   src/reporting/report_util.c \
   src/reporting/mytimeout.c \
   src/reporting/myout.c \
   src/work/work_cloud.c \
   src/work/work_report.c \
   src/work/work_loop.c \
   src/work/work_maintenance.c \
   src/work/work_etc.c \
   src/work/work_index.c \
   src/application.c \
   src/parsers/seq_parser.c \
   src/parsers/arg_parser.c \
   src/parsers/m8_parser.c \
   src/parsers/seq_to_profile.c \
   src/parsers/hmm_parser.c \
   src/parsers/index_parser.c \
   src/algs_naive/bound_fwdbck_naive.c \
   src/algs_vectorized/fwdback_vectorized.c \
   src/algs_quad/pruning_quad.c \
   src/algs_quad/traceback_quad.c \
   src/algs_quad/bound_posterior_quad.c \
   src/algs_quad/ranged_fwdback_quad.c \
   src/algs_quad/bound_viterbi_quad.c \
   src/algs_quad/bound_fwdbck_quad.c \
   src/algs_quad/merge_reorient_quad.c \
   src/algs_quad/posterior_null2_quad.c \
   src/algs_quad/viterbi_quad.c \
   src/algs_quad/fwdback_quad.c \
   src/algs_quad/posterior_quad.c \
   src/algs_quad/cloud_search_quad.c \
   src/pipelines/workflow.c \
   src/pipelines/pipeline_generic.c \
   src/pipelines/pipeline_hmmbuild.c \
   src/pipelines/pipeline_null.c \
   src/pipelines/pipeline_mmore.c \
   src/pipelines/pipeline_index.c \
   src/pipelines/pipeline_itest.c \
   src/pipelines/pipeline_mmore_main.c \
   src/pipelines/pipeline_interactive.c \
   src/pipelines/pipeline_utest.c \
   src/algs_sparse/bound_fwdbck_sparse.c \
   src/algs_sparse/viterbi_traceback_sparse.c \
   src/algs_sparse/bound_viterbi_sparse.c \
   src/algs_sparse/posterior_traceback_sparse.c \
   src/algs_sparse/posterior_null2_sparse.c \
   src/algs_sparse/posterior_sparse.c \
   src/algs_sparse/posterior_optacc_sparse.c \
   src/algs_linear/bound_fwdbck_linear.c \
   src/algs_linear/fwdback_linear.c \
   src/algs_linear/viterbi_traceback_linear.c \
   src/algs_linear/merge_reorient_linear.c \
   src/algs_linear/pruning_linear.c \
   src/algs_linear/viterbi_linear.c \
   src/algs_linear/cloud_search_linear.c \
   src/utilities/testing.c \
   src/utilities/visualizer.c \
   src/utilities/misc.c \
   src/utilities/error_handler.c \
   src/utilities/rng.c \
   src/utilities/dp_matrix_util.c \
   src/utilities/statistics.c \

STATS = \

BENCHMARKS = \

# utest and itest files currently not implemented.
UTESTS =\

ITESTS = \

EXAMPLES = \

# "auxprogs" are built but not installed.
AUXPROGS = \

PROGOBJS = \

AUXPROGOBJS = \

# beautification magic stolen from git
QUIET_SUBDIR0 = +${MAKE} -C #space separator after -c
QUIET_SUBDIR1 = 
ifndef V
	QUIET_CC      = @echo '    ' CC $@;
	QUIET_GEN     = @echo '    ' GEN $@;
	QUIET_AR      = @echo '    ' AR $@;
	QUIET_SUBDIR0 = +@subdir=
	QUIET_SUBDIR1 = ; echo '    ' SUBDIR $$subdir; \
		        ${MAKE} -s -C $$subdir
endif

.PHONY: all dev tests check install uninstall distclean clean TAGS

all:   ${PROGS} ${AUXPROGS} .FORCE

dev:   ${PROGS} ${AUXPROGS} ${UTESTS} ${ITESTS} ${STATS} ${BENCHMARKS} ${EXAMPLES} .FORCE
	${QUIET_SUBDIR0}${IMPLDIR} ${QUIET_SUBDIR1} dev

tests: ${PROGS} ${AUXPROGS} ${UTESTS} ${ITESTS} .FORCE
	${QUIET_SUBDIR0}${IMPLDIR} ${QUIET_SUBDIR1} tests

check: ${PROGS} ${AUXPROGS} ${UTESTS} ${ITESTS} .FORCE
	${QUIET_SUBDIR0}${IMPLDIR} ${QUIET_SUBDIR1} check

libhmmer.a: libhmmer-src.stamp .FORCE
	${QUIET_SUBDIR0}${IMPLDIR} ${QUIET_SUBDIR1} libhmmer-impl.stamp

libhmmer-src.stamp: ${OBJS}
	${QUIET_AR}${AR} -r libhmmer.a $? > /dev/null 2>&1 
	@${RANLIB} libhmmer.a
	@echo "src_lib objects compiled:\c" > $@
	@date >> $@

.FORCE:

${OBJS}:        ${HDRS} p7_config.h  
${PROGOBJS}:    ${HDRS} p7_config.h
${AUXPROGOBJS}: ${HDRS} p7_config.h

${PROGS} ${AUXPROGS}: % : %.o  libhmmer.a ../${ESLDIR}/libeasel.a 
	${QUIET_GEN}${CC} ${CFLAGS} ${PTHREAD_CFLAGS} ${PIC_CFLAGS} ${SSE_CFLAGS} ${VMX_CFLAGS} ${DEFS} ${LDFLAGS} ${MYLIBDIRS} -o $@ $@.o ${LIBS}

.c.o:
	${QUIET_CC}${CC} ${CFLAGS} ${PTHREAD_CFLAGS} ${PIC_CFLAGS} ${SSE_CFLAGS} ${VMX_CFLAGS} ${DEFS} ${CPPFLAGS} ${MYINCDIRS} -o $@ -c $<

${ITESTS}: % : %.o libhmmer.a ${HDRS} p7_config.h
	${QUIET_GEN}${CC} ${CFLAGS} ${PTHREAD_CFLAGS} ${PIC_CFLAGS} ${SSE_CFLAGS} ${VMX_CFLAGS} ${DEFS} ${LDFLAGS} ${MYLIBDIRS} -o $@ $@.o ${LIBS}

${UTESTS}: libhmmer.a  ${HDRS} p7_config.h
	@BASENAME=`echo $@ | sed -e 's/_utest//' | sed -e 's/^p7_//'` ;\
	DFLAG=`echo $${BASENAME} | sed -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`;\
	DFLAG=p7$${DFLAG}_TESTDRIVE ;\
	if test -e ${srcdir}/p7_$${BASENAME}.c; then \
           DFILE=${srcdir}/p7_$${BASENAME}.c ;\
        else \
           DFILE=${srcdir}/$${BASENAME}.c ;\
	fi;\
	if test ${V} ;\
	   then echo "{CC} ${CFLAGS} ${PTHREAD_CFLAGS} ${PIC_CFLAGS} ${SSE_CFLAGS} ${VMX_CFLAGS} ${CPPFLAGS} ${LDFLAGS} ${DEFS} ${MYLIBDIRS} ${MYINCDIRS} -D$${DFLAG} -o $@ $${DFILE} ${LIBS}" ;\
	   else echo '    ' GEN $@ ;\
        fi ;\
	${CC} ${CFLAGS} ${PTHREAD_CFLAGS} ${PIC_CFLAGS} ${SSE_CFLAGS} ${VMX_CFLAGS} ${CPPFLAGS} ${LDFLAGS} ${DEFS} ${MYLIBDIRS} ${MYINCDIRS} -D$${DFLAG} -o $@ $${DFILE} ${LIBS}

${BENCHMARKS}: libhmmer.a  ${HDRS} p7_config.h
	@BASENAME=`echo $@ | sed -e 's/_benchmark//' | sed -e 's/^p7_//'` ;\
	DFLAG=`echo $${BASENAME} | sed -e 'y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/'`;\
	DFLAG=p7$${DFLAG}_BENCHMARK ;\
	if test -e ${srcdir}/p7_$${BASENAME}.c; then \
           DFILE=${srcdir}/p7_$${BASENAME}.c ;\
        else \
           DFILE=${srcdir}/$${BASENAME}.c ;\
	fi;\
	if test ${V} ;\
	   then echo "{CC} ${CFLAGS} ${PTHREAD_CFLAGS} ${PIC_CFLAGS} ${SSE_CFLAGS} ${VMX_CFLAGS} ${CPPFLAGS} ${LDFLAGS} ${DEFS} ${MYLIBDIRS} ${MYINCDIRS} -D$${DFLAG} -o $@ $${DFILE} ${LIBS}" ;\
	   else echo '    ' GEN $@ ;\
        fi ;\
	${CC} ${CFLAGS} ${PTHREAD_CFLAGS}  ${PIC_CFLAGS} ${SSE_CFLAGS} ${VMX_CFLAGS} ${CPPFLAGS} ${LDFLAGS} ${DEFS} ${MYLIBDIRS} ${MYINCDIRS} -D$${DFLAG} -o $@ $${DFILE} ${LIBS}

install:
	for file in ${PROGS}; do \
	   ${INSTALL} -m 0755 $$file ${DESTDIR}${bindir}/ ;\
	done

uninstall:
	for file in ${PROGS}; do \
	   rm -f ${DESTDIR}${bindir}/$$file ;\
	done

clean:
	${QUIET_SUBDIR0}${IMPLDIR} ${QUIET_SUBDIR1} clean
	-rm -f *.o *~ Makefile.bak core ${PROGS} ${AUXPROGS} TAGS gmon.out
	-rm -f libhmmer.a libhmmer-src.stamp
	-rm -f ${UTESTS}
	-rm -f ${ITESTS}
	-rm -f ${STATS}
	-rm -f ${BENCHMARKS}
	-rm -f ${EXAMPLES}
	-rm -f *.gcno
	-rm -f cscope.out
	for prog in ${PROGS} ${AUXPROGS} ${UTESTS} ${STATS} ${BENCHMARKS} ${EXAMPLES} ${ITESTS}; do \
	   if test -d $$prog.dSYM; then rm -rf $$prog.dSYM; fi ;\
	done
ifndef V
	@echo '     ' CLEAN src
endif

distclean: clean
	${QUIET_SUBDIR0}${IMPLDIR} ${QUIET_SUBDIR1} distclean
	-rm -f Makefile p7_config.h



